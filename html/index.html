<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Παρακολούθηση Ξάνθης σε Πραγματικό Χρόνο</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #121212;
            color: #f4f4f9;
            transition: background-color 0.3s, color 0.3s;
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.8s ease-in-out;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        #info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            animation: slideUp 0.8s ease-in-out;
        }
        .data-box {
            font-size: 18px;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 300px;
            transition: background-color 0.3s, color 0.3s;
            color: #f4f4f9;
        }
        .alert-box {
            animation: blink 1.5s infinite;
        }
        @keyframes blink {
            0%, 100% { background-color: orange; }
            50% { background-color: #1e1e1e; }
        }
        h1, h2 {
            color: #f4f4f9;
            animation: fadeInText 1s ease-in-out;
        }
        @keyframes fadeInText {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            background-color: #333;
            color: white;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.3s;
        }
        button:hover {
            background-color: #555;
            transform: scale(1.05);
        }
        /* Dark Mode Switch */
        .wrapper {
            position: absolute;
            top: 20px;
            right: 20px;
            display: inline-block;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 140px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            top: -5px;
            right: 105%;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .switch {
            position: relative;
            width: 80px;
            height: 30px;
            appearance: none;
            background-color: rgb(4, 52, 73);
            border-radius: 15px;
            transition: background-image .7s ease-in-out;
            outline: none;
            cursor: pointer;
            overflow: hidden;
        }
        .switch:checked {
            background-color: rgb(0, 195, 255);
            transition: background-image 1s ease-in-out;
        }
        .switch:after {
            content: '';
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background-color: #fff;
            position: absolute;
            left: 2px;
            top: 2px;
            transform: translateX(0px);
            animation: off .7s forwards cubic-bezier(.8, .5, .2, 1.4);
            box-shadow: inset 5px -5px 4px rgba(53, 53, 53, 0.3);
        }
        @keyframes off {
            0% { transform: translateX(50px); width: 26px; }
            50% { width: 50px; border-radius: 15px; }
            100% { transform: translateX(0px); width: 26px; }
        }
        .switch:checked:after {
            animation: on .7s forwards cubic-bezier(.8, .5, .2, 1.4);
            box-shadow: inset -5px -5px 4px rgba(53, 53, 53, 0.3);
        }
        @keyframes on {
            0% { transform: translateX(0px); width: 26px; }
            50% { width: 50px; border-radius: 15px; }
            100% { transform: translateX(50px); width: 26px; }
        }
        .switch:checked:before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            left: 10px;
            top: 3px;
            background-color: transparent;
            box-shadow: 3px -1px 0px #fff;
            filter: blur(0px);
            animation: sun .7s forwards ease;
        }
        @keyframes sun {
            0% { transform: rotate(170deg); background-color: transparent; box-shadow: 3px -1px 0px #fff; filter: blur(0px); }
            50% { background-color: transparent; box-shadow: 3px -1px 0px #fff; filter: blur(0px); }
            90% { background-color: #f5daaa; box-shadow: 0px 0px 5px #f5deb4, 0px 0px 10px #f5deb4, 0px 0px 15px #f5deb4, inset 0px 0px 1px #efd3a3; filter: blur(1px); }
            100% { transform: rotate(0deg); background-color: #f5daaa; box-shadow: 0px 0px 5px #f5deb4, 0px 0px 10px #f5deb4, 0px 0px 15px #f5deb4, inset 0px 0px 1px #efd3a3; filter: blur(1px); }
        }
        .switch:before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            left: 10px;
            top: 3px;
            filter: blur(1px);
            background-color: #f5daaa;
            box-shadow: 0px 0px 5px #f5deb4, 0px 0px 10px #f5deb4, 0px 0px 15px #f5deb4, inset 0px 0px 1px #efd3a3;
            transform-origin: 30px 10px;
            animation: moon .7s forwards ease;
        }
        @keyframes moon {
            0% { transform: rotate(0deg); filter: blur(1px); }
            50% { filter: blur(1px); }
            90% { background-color: transparent; box-shadow: 3px -1px 0px #fff; filter: blur(0px); }
            100% { transform: rotate(170deg); background-color: transparent; box-shadow: 3px -1px 0px #fff; filter: blur(0px); }
        }
    </style>
</head>
<body>
    <h1>Παρακολούθηση Ξάνθης σε Πραγματικό Χρόνο</h1>
    <div id="map"></div>

    <h2>Δεδομένα σε Πραγματικό Χρόνο</h2>
    <div id="info">
        <div id="temperature" class="data-box">Θερμοκρασία: --°C</div>
        <div id="airQuality" class="data-box">Ποιότητα Αέρα: Δείκτης --</div>
        <div id="traffic" class="data-box">Κίνηση: --</div>
        <!-- Προσθήκη Περισσότερων Δεδομένων -->
        <div id="humidity" class="data-box">Υγρασία: --%</div>
        <div id="pressure" class="data-box">Πίεση: --hPa</div>
    </div>

    <!-- Dark Mode Switch με Tooltip -->
    <div class="wrapper tooltip">
        <input type="checkbox" id="darkModeSwitch" name="checkbox" class="switch">
        <span class="tooltiptext">Εναλλαγή Dark Mode</span>
    </div>

    <!-- Κουμπιά για Δοκιμαστικά Δεδομένα και Στατιστικά -->
    <button onclick="simulateData()">Δοκιμαστικά Δεδομένα</button>
    <button onclick="openStatsPage()">Προβολή Στατιστικών</button>

    <!-- Modal για ειδοποιήσεις -->
    <div id="alertModal">
        <div id="alertModalContent">
            <p id="alertMessage"></p>
            <button onclick="closeModal()">Κλείσιμο</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        let currentTemperature = 0;
        let currentAirQuality = 0;
        let currentTraffic = 0;
        let currentHumidity = 0;
        let currentPressure = 0;

        // Συνάρτηση για την Ανάκτηση Δεδομένων από το API
        async function fetchDataFromAPI() {
            try {
                const response = await fetch('https://your-app-name.onrender.com/data');  // Βάλε το σωστό URL του API
                if (!response.ok) {
                    throw new Error('Σφάλμα στην επικοινωνία με το API');
                }
                
                const data = await response.json();

                // Ενημέρωση των δεδομένων στην ιστοσελίδα
                document.getElementById('temperature').innerText = `Θερμοκρασία: ${data.temperature}°C`;
                document.getElementById('airQuality').innerText = `Ποιότητα Αέρα: Δείκτης ${data.airQuality}`;
                document.getElementById('traffic').innerText = `Κίνηση: ${data.traffic}`;
                
                // Ενημέρωση περισσότερων δεδομένων (π.χ., υγρασία και πίεση)
                document.getElementById('humidity').innerText = `Υγρασία: ${data.humidity}%`;
                document.getElementById('pressure').innerText = `Πίεση: ${data.pressure} hPa`;

                // Έλεγχος για ειδοποιήσεις
                handleNotifications(data);

                // Log μηνύματα για debugging
                console.log('Δεδομένα που ελήφθησαν:', data);
                
            } catch (error) {
                console.error('Σφάλμα στην ανάκτηση των δεδομένων:', error);
                showModal('Σφάλμα στην ανάκτηση των δεδομένων. Παρακαλώ δοκιμάστε ξανά αργότερα.');
            }
        }

        // Έλεγχος και Αποστολή Ειδοποιήσεων στον χρήστη
        function handleNotifications(data) {
            if (data.temperature > 35) sendNotification("Προειδοποίηση Θερμοκρασίας", `Η θερμοκρασία είναι ${data.temperature}°C!`);
            if (data.airQuality > 3) sendNotification("Προειδοποίηση Ποιότητας Αέρα", `Η ποιότητα αέρα είναι χαμηλή: Δείκτης ${data.airQuality}`);
            if (data.traffic > 80) sendNotification("Προειδοποίηση Κίνησης", `Υψηλή κίνηση: ${data.traffic}`);
        }

        // Επανάληψη της ανάκτησης δεδομένων κάθε 5 δευτερόλεπτα
        setInterval(fetchDataFromAPI, 5000);

        // Google Maps API για να δείξουμε τη θέση της Ξάνθης
        function initMap() {
            var xanthi = { lat: 41.1415, lng: 24.8830 };
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: xanthi
            });
            var marker = new google.maps.Marker({
                position: xanthi,
                map: map
            });
        }

        // Ενεργοποίηση Dark Mode κατά την αρχική φόρτωση
        function loadDarkModePreference() {
            const darkModeEnabled = localStorage.getItem('darkModeEnabled') === 'true';
            const darkModeSwitch = document.getElementById('darkModeSwitch');
            if (darkModeEnabled) {
                document.body.classList.add('dark-mode');
                darkModeSwitch.checked = true;
            } else {
                document.body.classList.remove('dark-mode');
                darkModeSwitch.checked = false;
            }
        }

        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkModeEnabled', isDarkMode.toString());
        }

        document.getElementById('darkModeSwitch').addEventListener('change', toggleDarkMode);

        // Αποστολή ειδοποιήσεων στον Browser
        function sendNotification(title, body) {
            if (Notification.permission === "granted") {
                new Notification(title, { body });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(title, { body });
                    }
                });
            }
        }

        // Συνάρτηση για προβολή της σελίδας στατιστικών
        function openStatsPage() {
            window.location.href = "stats.html"; // Προβολή της νέας σελίδας
        }

        // Συνάρτηση για εμφάνιση ειδοποιήσεων στο modal
        function showModal(message) {
            const modal = document.getElementById('alertModal');
            document.getElementById('alertMessage').innerText = message;
            modal.style.display = 'block';
        }

        // Συνάρτηση για κλείσιμο του modal παραθύρου
        function closeModal() {
            document.getElementById('alertModal').style.display = 'none';
        }

        // Αρχικοποίηση χάρτη και dark mode προτίμησης
        initMap();
        loadDarkModePreference();
    </script>

    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>
</body>
</html>
